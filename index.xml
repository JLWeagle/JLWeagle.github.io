<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>TylerW的部落格</title>
        <link>/</link>
        <description>Recent content on TylerW的部落格</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-CN</language>
        <lastBuildDate>Mon, 15 Nov 2021 20:01:59 +0800</lastBuildDate><atom:link href="/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>校园网配置IPv6 NAT</title>
        <link>/p/%E6%A0%A1%E5%9B%AD%E7%BD%91%E9%85%8D%E7%BD%AEipv6-nat/</link>
        <pubDate>Mon, 15 Nov 2021 20:01:59 +0800</pubDate>
        
        <guid>/p/%E6%A0%A1%E5%9B%AD%E7%BD%91%E9%85%8D%E7%BD%AEipv6-nat/</guid>
        <description>&lt;img src="/p/%E6%A0%A1%E5%9B%AD%E7%BD%91%E9%85%8D%E7%BD%AEipv6-nat/thread_weave_colorful_network_web-100728394-large.jpg" alt="Featured image of post 校园网配置IPv6 NAT" /&gt;&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;前一阵子给软路由折腾IPv6全局代理，配合AP实现所有连接的设备不走校园网计费流量。但是连接的每个终端无法直接访问纯IPv6网站了，原因是软路由没有给LAN口分配IPv6地址，于是开始折腾尝试解决这个问题。&lt;/p&gt;
&lt;h2 id=&#34;准备&#34;&gt;准备&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;网络：校园网IPv4/IPv6双栈&lt;/li&gt;
&lt;li&gt;硬件：软路由FriendlyElec NanoPi R2S&lt;/li&gt;
&lt;li&gt;固件：OpenWrt R21.8.6 / LuCI Master&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;lan口获取ipv6地址的三种方式&#34;&gt;LAN口获取IPv6地址的三种方式&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;IPv6穿透：将WAN口与LAN口桥接，路由器相当于交换机，连接的设备能够直接通过DHCPv6服务获取原生IPv6地址。但考虑到要使用Passwall等插件进行全局代理达到免流的效果，路由器自身需能够访问IPv6服务器，IPv6穿透这个方式行不通。&lt;/li&gt;
&lt;li&gt;IPv6中继：中继模式可以让路由器自身与LAN口连接的终端都获取到原生的IPv6地址，使用OpenWrt中的odhcpd可以实现。通过对&lt;code&gt;/etc/config/dhcp&lt;/code&gt;配置文件进行修改，WAN口和LAN口连接的设备均可以获取到20开头的公网IPv6地址。但是在我这边的环境配置后，LAN口连接的设备无论是DHCPv6还是SLAAC获取到的IP，都没有访问公网的权限。个人猜测是校园网认证的原因，因此只能使用第三种方式。&lt;/li&gt;
&lt;li&gt;IPv6 NAT：网络地址转换(NAT, Network Address Translation)是为了解决IPv4地址短缺所提出的技术，普遍应用在有多台主机但只通过一个公网IP地址访问互联网的私有网络中。理论上IPv6拥有&lt;code&gt;2^128 = 340,282,366,920,938,463,463,374,607,431,768,211,456&lt;/code&gt;个地址，不会存在短缺的情况，按理说也就并不需要使用NAT。但是仍然存在IPv6 NAT这种接入方式。这种方式配置简单，缺点是连接的设备没有公网IPv6地址，不能直接被外部设备访问。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ipv6-nat配置步骤&#34;&gt;IPv6 NAT配置步骤&lt;/h2&gt;
&lt;h3 id=&#34;wan口设置&#34;&gt;WAN口设置&lt;/h3&gt;
&lt;h3 id=&#34;ipv6-ula前缀设置&#34;&gt;IPv6 ULA前缀设置&lt;/h3&gt;
&lt;h3 id=&#34;lan口设置&#34;&gt;LAN口设置&lt;/h3&gt;
&lt;h3 id=&#34;防火墙与路由设置&#34;&gt;防火墙与路由设置&lt;/h3&gt;
</description>
        </item>
        <item>
        <title>Ubuntu 21.04 搭建TeamSpeak服务端</title>
        <link>/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/</link>
        <pubDate>Sat, 13 Nov 2021 18:09:52 +0800</pubDate>
        
        <guid>/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/</guid>
        <description>&lt;img src="/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/helena-hertz-wWZzXlDpMog-unsplash.jpg" alt="Featured image of post Ubuntu 21.04 搭建TeamSpeak服务端" /&gt;&lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;TeamSpeak以其游戏语音聊天功能闻名，与主流的语音软件相比，它拥有高语音质量、低延时，更少的带宽使用和提供游戏内叠加等优点。使用起来也比其它“语音电话”的方式要简洁、舒适一些。&lt;/p&gt;
&lt;h2 id=&#34;准备&#34;&gt;准备&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;一个装有Ubuntu 21.04系统的VPS&lt;/li&gt;
&lt;li&gt;VPS的管理员访问权限&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;搭建步骤&#34;&gt;搭建步骤&lt;/h2&gt;
&lt;h3 id=&#34;登录服务器并更新软件包&#34;&gt;登录服务器并更新软件包&lt;/h3&gt;
&lt;p&gt;首先，使用SSH登录VPS，Windows下可以使用PuTTY等软件连接SSH：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ssh root@服务器IP地址
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;检查并更新已安装的软件包：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get update -y
apt-get upgrade -y
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;安装teamspeak服务端&#34;&gt;安装TeamSpeak服务端&lt;/h3&gt;
&lt;p&gt;添加一个单独的用户来运行TeamSpeak服务端：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;adduser --disabled-login teamspeak
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加用户时的信息可以一路回车。创建好后，切换到TeamSpeak用户，下载最新的TeamSpeak服务端文件：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;su - teamspeak
wget https://files.teamspeak-services.com/releases/server/3.13.6/teamspeak3-server_linux_amd64-3.13.6.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解压下载好的压缩包，移动到TeamSpeak用户目录下并删除文件夹与压缩包：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;tar xvfj teamspeak3-server_linux_amd64-3.13.6.tar.bz2
cp teamspeak3-server_linux_amd64/* -R /home/teamspeak/
rm -rf teamspeak3-server_linux_amd64 teamspeak3-server_linux_amd64-3.13.6.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;创建服务端的License文件，切换回root：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;touch .ts3server_license_accepted
exit
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;配置teamspeak服务文件&#34;&gt;配置TeamSpeak服务文件&lt;/h3&gt;
&lt;p&gt;接下来，创建TeamSpeak的Systemd服务文件：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim /lib/systemd/system/ts3server.service
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;复制以下内容并保存：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[Unit]
Description=Teamspeak Service
Wants=network.target

[Service]
WorkingDirectory=/home/teamspeak
User=teamspeak
ExecStart=/home/teamspeak/ts3server_minimal_runscript.sh
ExecStop=/home/teamspeak/ts3server_startscript.sh stop
ExecReload=/home/teamspeak/ts3server_startscript.sh restart
Restart=always
RestartSec=15

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;防火墙放行语音和文件传输的端口，重启防火墙：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ufw allow 9987
ufw allow 30033
ufw reload
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启Systemd服务，运行TeamSpeak服务端并将其设置为开机自启：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl daemon-reload
systemctl start ts3server
systemctl enable ts3server
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看服务端状态：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl status ts3server
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;日志中的token是语音服务器管理员权限的口令。复制下来，首次登录需要输入：
&lt;figure 
	
		class=&#34;gallery-image&#34; 
		style=&#34;
			flex-grow: 1073; 
			flex-basis: 2577px&#34;
	&gt;
	&lt;a href=&#34;/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/TeamSpeak_token.png&#34; data-size=&#34;988x92&#34;&gt;
		&lt;img src=&#34;/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/TeamSpeak_token.png&#34;
			width=&#34;988&#34;
			height=&#34;92&#34;
			srcset=&#34;/p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/TeamSpeak_token_huf45fc9513752e6fc6c1cd739ee26261d_75526_480x0_resize_box_3.png 480w, /p/ubuntu-21.04-%E6%90%AD%E5%BB%BAteamspeak%E6%9C%8D%E5%8A%A1%E7%AB%AF/TeamSpeak_token_huf45fc9513752e6fc6c1cd739ee26261d_75526_1024x0_resize_box_3.png 1024w&#34;
			loading=&#34;lazy&#34;
			alt=&#34;TeamSpeak管理员口令&#34;&gt;
	&lt;/a&gt;
	
	&lt;figcaption&gt;TeamSpeak管理员口令&lt;/figcaption&gt;
	
&lt;/figure&gt; 
到这里，打开TeamSpeak客户端就可以正常连接了。&lt;/p&gt;
&lt;h2 id=&#34;注意事项&#34;&gt;注意事项&lt;/h2&gt;
&lt;p&gt;如果搭建后出现连接失败的情况，请检查相关的端口是否被防火墙放行。不同发行的Linux操作系统设置防火墙有细微的差别，有些VPS需要在控制台中进行防火墙的设置。&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
